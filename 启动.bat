@echo off
chcp 65001 >nul
cd /d "%~dp0"

echo.
echo ================================================
echo   ğŸš— äºŒæ‰‹è½¦é›†å¸‚ - å¿«é€Ÿå¯åŠ¨è„šæœ¬
echo ================================================
echo.

REM æ£€æŸ¥è™šæ‹Ÿç¯å¢ƒ
if not exist "venv" (
    echo â„¹ è™šæ‹Ÿç¯å¢ƒä¸å­˜åœ¨ï¼Œæ­£åœ¨åˆ›å»º...
    python -m venv venv
    echo âœ“ è™šæ‹Ÿç¯å¢ƒåˆ›å»ºå®Œæˆ
) else (
    echo âœ“ è™šæ‹Ÿç¯å¢ƒå·²å­˜åœ¨
)

echo.
echo â„¹ æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ...
call venv\Scripts\activate.bat

echo.
echo â„¹ å®‰è£…/æ›´æ–°ä¾èµ–...
pip install -r requirements.txt -q
if %ERRORLEVEL% EQU 0 (
    echo âœ“ ä¾èµ–å®‰è£…å®Œæˆ
) else (
    echo âš  ä¾èµ–å®‰è£…æœ‰è­¦å‘Šï¼Œä½†ç»§ç»­å¯åŠ¨...
)

echo.
echo â„¹ è¿è¡Œæ•°æ®åº“è¿ç§»...
python manage.py migrate --noinput
if %ERRORLEVEL% EQU 0 (
    echo âœ“ æ•°æ®åº“è¿ç§»å®Œæˆ
) else (
    echo âš  æ•°æ®åº“è¿ç§»æœ‰è­¦å‘Šï¼Œä½†ç»§ç»­å¯åŠ¨...
)

echo.
echo ================================================
echo   ğŸš— äºŒæ‰‹è½¦é›†å¸‚ - å¼€å‘æœåŠ¡å™¨
echo ================================================
echo.
echo è®¿é—®åœ°å€: http://127.0.0.1:5000/
echo ç«¯å£: 5000
echo.
echo æ“ä½œè¯´æ˜:
echo   â€¢ æŒ‰ Ctrl+C åœæ­¢æœåŠ¡å™¨
echo   â€¢ ä¿®æ”¹ä»£ç åè‡ªåŠ¨é‡æ–°åŠ è½½
echo   â€¢ æ‰€æœ‰æ—¥å¿—è¾“å‡ºåœ¨ä¸‹æ–¹æ˜¾ç¤º
echo   â€¢ æµè§ˆå™¨å°†è‡ªåŠ¨æ‰“å¼€
echo.
echo ================================================
echo   å®æ—¶è¿è¡Œæ—¥å¿—
echo ================================================
echo.

REM åœ¨åå°å¯åŠ¨æµè§ˆå™¨ï¼ˆå»¶è¿Ÿ3ç§’ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨ï¼‰
timeout /t 1 /nobreak > nul
start http://127.0.0.1:5000/

REM å¯åŠ¨DjangoæœåŠ¡å™¨
python manage.py runserver 127.0.0.1:5000 --verbosity 2

pause
